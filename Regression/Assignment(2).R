titanic <- read.csv("http://www.math.ku.dk/~susanne/titanic.txt",header = TRUE,colClasses = c("factor", "integer","factor", "numeric", "integer", "integer"))
summary(titanic)

library(Hmisc)
library(rms)
library(lattice???


a <- aregImpute(~pclass+survived+sex+age+sibsp+parch,n.impute = 5,nk=0,data = titanic)
f <- fit.mult.impute(survived~pclass+sex+age+sibsp+parch,fitter = function(...) glm(..., family = binomial(link="logit")),xtrans = a,data = titanic)
print(f)

glm<-glm(survived~pclass+sex+age+sibsp+parch,family = binomial(link = "logit"),data = f$data)
print(glm)

titanic1 <- f$data



#????????????qqplot
library("car")
par(mfrow=c(1,2))
hist(titanic1$age, prob=T, xlab='', main='Histogram of age') #???????????????????????????
lines(density(titanic1$age,na.rm=T),col='blue')#?????????????????????????????????????????????
rug(jitter(titanic1$age),col = 'blue') #??????????????????????????????????????????????????????????????????????????????????????????
qqPlot(titanic1$age,ylab='age',main='Normal QQ plot of age',col.lines = 'purple') #???????????????????????????
par(mfrow=c(1,1))



#?????????
par(mfrow=c(1,2))#?????????????????????1??????????????????????????????
dotchart(titanic1$age)#????????????????????????,?????????
pc=boxplot(titanic1$age,horizontal=T)#?????????????????????

plot(titanic1$age,xlab='')
abline(h=mean(titanic1$age,na.rm=T),lty=1,col = 'red')
abline(h=mean(titanic1$age,na.rm=T)+sd(titanic1$age,na.rm=T),lty=2,col= 'green')
abline(h=median(titanic1$age,na.rm=T),lty=3,col='blue')


#???????????????train, test
n <- nrow(titanic1)
mark <- rep(FALSE, n)
mark[sample(n, round(9*n/10))] <- TRUE
train <- titanic1[mark, ]
test <- titanic1[!mark, ]

glm1<-glm(survived~pclass+sex+age+sibsp+parch,family = binomial(link = "logit"),data = train)
print(glm)



